(function(e,t){typeof exports==`object`&&typeof module<`u`?t(exports,require(`vue`),require(`marked`)):typeof define==`function`&&define.amd?define([`exports`,`vue`,`marked`],t):(e=typeof globalThis<`u`?globalThis:e||self,t(e.VueMarkdownEditor={},e.Vue,e.marked))})(this,function(e,t,n){Object.defineProperty(e,`__esModule`,{value:!0});var r=(e,t)=>{let n=e.__vccOpts||e;for(let[e,r]of t)n[e]=r;return n},i={key:0,class:`markdown-editor__toolbar`},a={class:`markdown-editor__panes`},o={class:`markdown-editor__editor-pane`},s={class:`markdown-editor__editor-shell`},c={key:0,class:`markdown-editor__gutter`},l=[`readonly`,`placeholder`],u={key:0,class:`markdown-editor__preview-pane`},d=[`innerHTML`],f=r({__name:`MarkdownEditor`,props:{modelValue:{type:String,default:``},theme:{type:String,default:`dark`,validator:e=>[`dark`,`light`].includes(e)},readOnly:{type:Boolean,default:!1},showLineNumbers:{type:Boolean,default:!0},showToolbar:{type:Boolean,default:!0},showPreview:{type:Boolean,default:!0},autofocus:{type:Boolean,default:!1},placeholder:{type:String,default:``},toolbarItems:{type:Array,default:()=>[`h1`,`h2`,`bold`,`italic`,`unordered-list`,`ordered-list`,`blockquote`,`code-block`,`horizontal-rule`,`link`,`image`]}},emits:[`update:modelValue`,`change`,`save`,`focus`,`blur`],setup(e,{emit:r}){let f=e,p=r,m=(0,t.ref)(f.modelValue||`# 欢迎使用 Markdown 编辑器

## 快速上手

- 左侧是自研编辑器（带行号、代码风格）
- 右侧实时预览渲染效果
- Tab 支持缩进，Ctrl+B 支持加粗
`),h=(0,t.ref)(null);n.marked.setOptions({breaks:!0});let g=(0,t.computed)(()=>n.marked.parse(m.value)),_=(0,t.computed)(()=>m.value?m.value.split(`
`):[``]);(0,t.watch)(()=>f.modelValue,e=>{e!==m.value&&(m.value=e||``)});let v=e=>{f.readOnly||(m.value=e,p(`update:modelValue`,e),p(`change`,e))},y=()=>{v(m.value)},b=e=>{if(f.readOnly)return;let t=h.value;if(!t)return;let n=m.value,r=t.selectionStart,i=t.selectionEnd,a=n.lastIndexOf(`
`,r-1)+1,o=n.indexOf(`
`,i),s=o===-1?n.length:o,c=n.slice(0,a),l=n.slice(a,s),u=n.slice(s);m.value=c+l.split(`
`).map((t,n)=>e(t,n)).join(`
`)+u,requestAnimationFrame(()=>{t.focus()}),y()},x=(e,t)=>{if(f.readOnly)return;let n=h.value;if(!n)return;let r=m.value,i=n.selectionStart,a=n.selectionEnd,o=r.slice(i,a),s=o.startsWith(e)&&o.endsWith(t)&&o.length>e.length+t.length,c=o||``,l=s?c.slice(e.length,c.length-t.length):`${e}${c||`文本`}${t}`,u=r.slice(0,i),d=r.slice(a);m.value=u+l+d;let p=u.length+(s?0:e.length),g=p+(c||`文本`).length;requestAnimationFrame(()=>{n.focus(),n.selectionStart=p,n.selectionEnd=g}),y()},S=e=>{b(t=>{let n=t.trimStart(),r=n.replace(/^#{1,6}\s+/,``),i=t.length-n.length,a=r||`标题`,o=`#`.repeat(e)+` `;return`${` `.repeat(i)}${o}${a}`})},C=()=>{b(e=>{let t=e.trimStart(),n=e.length-t.length;return t?/^[-*+]\s+/.test(t)?e:`${` `.repeat(n)}- ${t}`:`${` `.repeat(n)}- `})},w=()=>{b((e,t)=>{let n=e.trimStart(),r=e.length-n.length,i=t+1;return n?/^\d+\.\s+/.test(n)?e:`${` `.repeat(r)}${i}. ${n}`:`${` `.repeat(r)}${i}. `})},T=()=>{b(e=>{let t=e.trimStart(),n=e.length-t.length;return t?/^>\s+/.test(t)?e:`${` `.repeat(n)}> ${t}`:`${` `.repeat(n)}> `})},E=()=>{if(f.readOnly)return;let e=h.value;if(!e)return;let t=m.value,n=e.selectionStart,r=e.selectionEnd,i=t.slice(n,r);if(!i){let i=t.slice(0,n),a=t.slice(r);m.value=i+"```\n代码\n```"+a;let o=i.length+4,s=o+2;requestAnimationFrame(()=>{e.focus(),e.selectionStart=o,e.selectionEnd=s}),y();return}let a=t.slice(0,n),o=t.slice(r);m.value=a+`\`\`\`\n${i}\n\`\`\``+o;let s=a.length+4,c=s+i.length;requestAnimationFrame(()=>{e.focus(),e.selectionStart=s,e.selectionEnd=c}),y()},D=()=>{if(f.readOnly)return;let e=h.value;if(!e)return;let t=m.value,n=e.selectionStart,r=e.selectionEnd,i=t.slice(0,n),a=t.slice(r),o=`${i.endsWith(`
`)||!i?``:`
`}---${a.startsWith(`
`)||!a?``:`
`}`;m.value=i+o+a;let s=(i+o).length;requestAnimationFrame(()=>{e.focus(),e.selectionStart=s,e.selectionEnd=s}),y()},O=()=>{if(f.readOnly)return;let e=h.value;if(!e)return;let t=m.value,n=e.selectionStart,r=e.selectionEnd,i=t.slice(n,r)||`链接文本`,a=t.slice(0,n),o=t.slice(r);m.value=a+`[${i}](https://)`+o;let s=(a+`[${i}](`).length,c=s+8;requestAnimationFrame(()=>{e.focus(),e.selectionStart=s,e.selectionEnd=c}),y()},k=()=>{if(f.readOnly)return;let e=h.value;if(!e)return;let t=m.value,n=e.selectionStart,r=e.selectionEnd,i=t.slice(n,r)||`图片描述`,a=t.slice(0,n),o=t.slice(r);m.value=a+`![${i}](https://)`+o;let s=(a+`![${i}](`).length,c=s+8;requestAnimationFrame(()=>{e.focus(),e.selectionStart=s,e.selectionEnd=c}),y()},A=e=>{let t=h.value;if(t){if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()===`b`){e.preventDefault(),x(`**`,`**`);return}if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()===`s`){e.preventDefault(),p(`save`,m.value);return}if(!f.readOnly&&e.key===`Tab`){e.preventDefault();let n=m.value,r=t.selectionStart,i=t.selectionEnd,a=n.lastIndexOf(`
`,r-1)+1,o=n.indexOf(`
`,i),s=o===-1?n.length:o,c=n.slice(0,a),l=n.slice(a,s),u=n.slice(s);if(e.shiftKey){let e=l.split(`
`).map(e=>e.startsWith(`  `)?e.slice(2):e).join(`
`);m.value=c+e+u;let n=l.length-e.length;requestAnimationFrame(()=>{t.selectionStart=r-n,t.selectionEnd=i-n})}else{let e=l.split(`
`).map(e=>`  `+e).join(`
`);m.value=c+e+u;let n=e.length-l.length;requestAnimationFrame(()=>{t.selectionStart=r+2,t.selectionEnd=i+n})}y()}}},j=e=>{p(`focus`,e)},M=e=>{p(`blur`,e)},N=(0,t.computed)(()=>[`markdown-editor`,`markdown-editor--${f.theme}`]);return(n,r)=>((0,t.openBlock)(),(0,t.createElementBlock)(`div`,{class:(0,t.normalizeClass)(N.value)},[e.showToolbar?((0,t.openBlock)(),(0,t.createElementBlock)(`div`,i,[(0,t.renderSlot)(n.$slots,`toolbar`,{wrapSelection:x,toggleHeading:S,insertUnorderedList:C,insertOrderedList:w,insertBlockquote:T,insertCodeBlock:E,insertHorizontalRule:D,insertLink:O,insertImage:k},()=>[e.toolbarItems.includes(`h1`)?((0,t.openBlock)(),(0,t.createElementBlock)(`button`,{key:0,type:`button`,class:`markdown-editor__toolbar-button`,onClick:r[0]||=e=>S(1),title:`一级标题`},` H1 `)):(0,t.createCommentVNode)(``,!0),e.toolbarItems.includes(`h2`)?((0,t.openBlock)(),(0,t.createElementBlock)(`button`,{key:1,type:`button`,class:`markdown-editor__toolbar-button`,onClick:r[1]||=e=>S(2),title:`二级标题`},` H2 `)):(0,t.createCommentVNode)(``,!0),e.toolbarItems.includes(`bold`)?((0,t.openBlock)(),(0,t.createElementBlock)(`button`,{key:2,type:`button`,class:`markdown-editor__toolbar-button`,onClick:r[2]||=e=>x(`**`,`**`),title:`加粗 (Ctrl+B)`},` 加粗 `)):(0,t.createCommentVNode)(``,!0),e.toolbarItems.includes(`italic`)?((0,t.openBlock)(),(0,t.createElementBlock)(`button`,{key:3,type:`button`,class:`markdown-editor__toolbar-button`,onClick:r[3]||=e=>x(`*`,`*`),title:`斜体`},` 斜体 `)):(0,t.createCommentVNode)(``,!0),e.toolbarItems.includes(`unordered-list`)?((0,t.openBlock)(),(0,t.createElementBlock)(`button`,{key:4,type:`button`,class:`markdown-editor__toolbar-button`,onClick:C,title:`无序列表`},` 无序列表 `)):(0,t.createCommentVNode)(``,!0),e.toolbarItems.includes(`ordered-list`)?((0,t.openBlock)(),(0,t.createElementBlock)(`button`,{key:5,type:`button`,class:`markdown-editor__toolbar-button`,onClick:w,title:`有序列表`},` 有序列表 `)):(0,t.createCommentVNode)(``,!0),e.toolbarItems.includes(`blockquote`)?((0,t.openBlock)(),(0,t.createElementBlock)(`button`,{key:6,type:`button`,class:`markdown-editor__toolbar-button`,onClick:T,title:`引用`},` 引用 `)):(0,t.createCommentVNode)(``,!0),e.toolbarItems.includes(`code-block`)?((0,t.openBlock)(),(0,t.createElementBlock)(`button`,{key:7,type:`button`,class:`markdown-editor__toolbar-button`,onClick:E,title:`代码块`},` 代码块 `)):(0,t.createCommentVNode)(``,!0),e.toolbarItems.includes(`horizontal-rule`)?((0,t.openBlock)(),(0,t.createElementBlock)(`button`,{key:8,type:`button`,class:`markdown-editor__toolbar-button`,onClick:D,title:`分割线`},` 分割线 `)):(0,t.createCommentVNode)(``,!0),e.toolbarItems.includes(`link`)?((0,t.openBlock)(),(0,t.createElementBlock)(`button`,{key:9,type:`button`,class:`markdown-editor__toolbar-button`,onClick:O,title:`链接 [文本](url)`},` 链接 `)):(0,t.createCommentVNode)(``,!0),e.toolbarItems.includes(`image`)?((0,t.openBlock)(),(0,t.createElementBlock)(`button`,{key:10,type:`button`,class:`markdown-editor__toolbar-button`,onClick:k,title:`图片 ![alt](url)`},` 图片 `)):(0,t.createCommentVNode)(``,!0)],!0)])):(0,t.createCommentVNode)(``,!0),(0,t.createElementVNode)(`div`,a,[(0,t.createElementVNode)(`div`,o,[(0,t.createElementVNode)(`div`,s,[e.showLineNumbers?((0,t.openBlock)(),(0,t.createElementBlock)(`div`,c,[((0,t.openBlock)(!0),(0,t.createElementBlock)(t.Fragment,null,(0,t.renderList)(_.value,(e,n)=>((0,t.openBlock)(),(0,t.createElementBlock)(`div`,{key:n,class:`markdown-editor__line-number`},(0,t.toDisplayString)(n+1),1))),128))])):(0,t.createCommentVNode)(``,!0),(0,t.withDirectives)((0,t.createElementVNode)(`textarea`,{ref_key:`textareaRef`,ref:h,"onUpdate:modelValue":r[4]||=e=>m.value=e,class:`markdown-editor__textarea`,spellcheck:`false`,readonly:e.readOnly,placeholder:e.placeholder,onInput:y,onKeydown:A,onFocus:j,onBlur:M},null,40,l),[[t.vModelText,m.value]])])]),e.showPreview?((0,t.openBlock)(),(0,t.createElementBlock)(`div`,u,[(0,t.renderSlot)(n.$slots,`preview`,{html:g.value},()=>[(0,t.createElementVNode)(`div`,{class:`markdown-editor__preview`,innerHTML:g.value},null,8,d)],!0)])):(0,t.createCommentVNode)(``,!0)])],2))}},[[`__scopeId`,`data-v-1cc521b6`]]),p=f;e.MarkdownEditor=f,e.default=p});